% intro.tex

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \begin{center}
    \fig{width = 0.80\textwidth}{figs/unistore-atc21}
    \vspace{0.20cm}
    \red{ATC'2021 (CCF A)}

    \vspace{1.00cm}
    UniStore is the first fault-tolerant and scalable transactional data store
    that combines causal and strong consistency.

    \vspace{0.30cm}
    对协议设计有理论参考与应用指导价值
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \begin{center}
    {\it Partial Order-Restrictions Consistency (PoR consistency)}

    \vspace{0.30cm}
    介于\blue{(事务) 因果一致性}与\blue{可串行化}之间

    \vspace{1.20cm}
    \begin{description}
      \item[\red{关键挑战 (一):}] 在容错的情况下保证系统的活性 (liveness) \\[10pt]
      \item[\red{关键挑战 (二):}] 严格的协议正确性证明
    \end{description}
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{} % {\footnotesize{(\purple{ATC'2021})}}}
  \begin{center}
    \fig{width = 0.80\textwidth}{figs/unistore-atc21}
    \vspace{0.20cm}
    \red{ATC'2021 (CCF A)}

    \vspace{1.20cm}
    负责\blue{严格的正确性证明}工作 \\[3pt]
    (完成 \textsf{arXiv} 完整版本中的20页证明) \\[12pt]

    在证明过程中发现协议中一处\red{较为严重的错误} \\[3pt]
    (同样存在于经典协议中)
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \begin{center}
    弱一致性 (事务因果一致性): 低延迟、高可用
    % Weak consistency: low latency, high availability

    \fig{width = 0.40\textwidth}{figs/best-of-both-worlds}

    强一致性 (可串行化): 易理解, 易编程, 易于满足应用不变式
    % Strong consistency: easy to preserve critical application invariants
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \begin{center}
    \textsc{deposit \quad \red{withdraw} \quad query \quad interest}
    \fig{width = 0.50\textwidth}{figs/banking}
    \red{应用不变式: $\textsf{balance} \ge 0$}

    \pause
    \vspace{0.60cm}
    TODO: 事务因果一致性允许并发的 \textsc{withdraw} 执行，提升性能
    % Causal consistency allows two concurrent \textsc{withdraw} \\
    % to execute without knowing each other.

    \pause
    \vspace{0.30cm}
    只有 \textsc{withdraw} 需要使用强一致性, 按某种顺序执行
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \begin{center}
    \unistore{} implements a transactional variant of \\
    \red{Partial Order-Restrictions} (\por) consistency~\purple{
      \footnotesize [Li@ACT'2018]}

    \vspace{0.80cm}
    \begin{description}[(II)]
      \setlength{\itemsep}{8pt}
      \item[(I)] 默认情况下, 使用事务因果一致性
      \item[(II)] 允许用户定义事务之间的冲突关系; 冲突事务按顺序执行
    \end{description}
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \begin{definition}[Session Order]
    A transaction $t_{1}$ precedes a transaction $t_{2}$
    in the \red{session order}, denoted \red{$t_{1} \rel{\so} t_{2}$},
    if they are executed by the same client and $t_{1}$ is executed before $t_{2}$.
  \end{definition}

  \vspace{0.60cm}
  \begin{definition}[Conflict Relation]
    The \red{conflict relation}, denoted \red{$\conflict$},
    between transactions is a symmetric relation.
    \[
      t_{1} \conflict t_{2} \iff t_{2} \conflict t_{1}.
    \]
  \end{definition}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Consistency Model of \unistore}
  \begin{definition}[\por]
    A set of transactions $\txs \triangleq \causaltxs \uplus \strongtxs$
    committed by \unistore{} satisfies \blue{\por{}}
    if there exists a \red{causal order $\prec$} on $T$ such that

    \vspace{0.30cm}
    \begin{description}[\ev:]
      \setlength{\itemsep}{8pt}
      \item[\causalityaxiom:]
        \uncover<2->{
          `$\prec$' is a partial order and $\so \subseteq\; \prec$.
        }
      \item[\conflictaxiom:]
        \uncover<3->{$\forall t_{1}, t_{2} \in \strongtxs.\;
            t_{1} \conflict t_{2} \implies t_{1} \prec t_{2} \lor t_{2} \prec t_{1}.$
        }
      \item[\ev:]
        \uncover<4->{
          A transaction $t \in T$ that is either \purple{strong}
          or \teal{originates at a correct data center}
          eventually become \red{visible} at all \violet{correct} data centers:
          from some point on, $t$ precedes \red{in $\prec$} all transactions issued
          at correct data centers.
        }
      \item[\retval:]
        \uncover<5->{
          $\intretval \land \extretval$
        }
    \end{description}
  \end{definition}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Consistency Model of \unistore}
  \begin{center}
    Consider a read $r$ from key $k$ in a transaction $t$.

    \vspace{0.80cm}
    \blue{$\intretval:$} read from the latest update on $k$ preceding $r$ in $t$

    \[
      \retval = \blue{\intretval} \land \red{\extretval}
    \]

    \vspace{0.50cm}
    \red{$\extretval:$} read from the last update on $k$ \\[3pt]
    of the latest transaction (in an order consistent with $\prec$) preceding $t$
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Consistency Model of \unistore}
  \begin{center}
    \textsc{deposit \quad \red{withdraw} \quad query \quad interest}
    \fig{width = 0.50\textwidth}{figs/banking}
    \red{Invariant: $\textsf{balance} \ge 0$}

    \vspace{0.50cm}
    Declaring that strong transactions \\[3pt]
    including \textsc{withdraw} on the same account conflict.
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Design Challenge of \unistore}
  \begin{center}
    {To satisfy \red{liveness (\ev)} despite failures}
    \fig{width = 0.50\textwidth}{figs/design-challenges}

    \vspace{0.50cm}
    A transaction $t \in T$ that is either \purple{strong}
    or \teal{originates at a correct data center}
    eventually become \red{visible} at all \violet{correct} data centers.
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Design Challenge of \unistore{} (I)}
  \begin{center}
    $d_{1}$ 本地提交了事务 $t_{1}$, \\[3pt]
    但在将 $t_{1}$ 复制到 $d_{3}$ 之前, $d_{1}$ 出现故障

    \vspace{0.20cm}
    \fig{width = 0.70\textwidth}{figs/liveness-causal}

    \pause
    事务 $t_{2}$ 依赖于 $t_{1}$, \\[3pt]
    因此, 在 $d_{3}$ 上, $t_{2}$ 可能永远不可见, 违反``活性''要求
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Fault-tolerance of \unistore{} (I)}
  \begin{center}
    $d_{1}$ 本地提交了事务 $t_{1}$, \\[3pt]
    但在将 $t_{1}$ 复制到 $d_{3}$ 之前, $d_{1}$ 出现故障

    \vspace{0.20cm}
    \fig{width = 0.70\textwidth}{figs/liveness-causal}

    \pause
    事务 $t_{2}$ 依赖于 $t_{1}$, $d_{2}$ 需要向 $d_{3}$ \red{转发} $t_{1}$
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Design Challenge of \unistore{} (II)}
  \begin{center}
    Data center $d_{1}$ crashes \\[3pt]
    before $\causalcolor{t_{1}}$ is replicated to correct data center $d_{3}$.

    \vspace{0.50cm}
    \fig{width = 1.00\textwidth}{figs/liveness-strong}

    \pause
    \vspace{0.30cm}
    Transaction $\strongcolor{t_{2}}$ will never be visible at $d_{3}$. \\[3pt]
    No transaction $\strongcolor{t_{3}}$ conflicting with $\strongcolor{t_{2}}$ can commit \\
    (by $\conflictaxiom$).
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Fault-tolerance of \unistore{} (II)}
  \begin{center}
    \unistore{} ensures that before a strong transaction commits, \\[3pt]
    all its causal dependencies are \red{uniform}, \\[3pt]
    i.e., will eventually become visible at all correct data centers.

    \vspace{0.30cm}
    \fig{width = 1.00\textwidth}{figs/liveness-strong}

    \pause
    Transaction $\causalcolor{t_{1}}$ will eventually be visible at $d_{3}$. \\[3pt]
    Transaction $\strongcolor{t_{2}}$ will eventually be visible at $d_{3}$. \\[3pt]
    Transaction $\strongcolor{t_{3}}$ may be committed at $d_{3}$. \\[3pt]
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Performance of \unistore}
  \begin{center}
    Causal transactions remain highly-available, i.e., committed locally. \\[6pt]

    \vspace{0.30cm}
    \fig{width = 1.00\textwidth}{figs/liveness-strong}

    \vspace{0.20cm}
    A strong transaction may have to \red{wait} for some of its dependencies
    to become uniform before committing.

    \pause
    \vspace{0.50cm}
    \red{However, this may cost too much.}
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Performance of \unistore{}}
  \begin{center}
    \unistore{} makes a remote causal transaction visible to clients \\[3pt]
    only \red{after it is uniform}.

    \vspace{0.30cm}
    Causal transactions are executed on an (almost) \\[3pt]
    \red{uniform snapshot} that may be slightly in the past.

    \vspace{0.50cm}
    \fig{width = 1.00\textwidth}{figs/liveness-strong}

    \pause
    A strong transaction only needs to wait for causal transactions \\[3pt]
    originating at the \red{local} data center to become uniform.
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Scalability of \unistore}
  \begin{center}
    \unistore{} scales horizontally, \\[3pt]
    i.e., with the number of machines ({partitions}) in each data center.
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%